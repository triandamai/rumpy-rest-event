version: "3"

services:
  string-team-api:
    build:
      context: .
      dockerfile: prod.Dockerfile
    restart: always
    ports:
      - "3000"
    networks:
      - dokploy-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.<unique-name>.rule=Host(`your-domain.com`)"
      - "traefik.http.routers.<unique-name>.entrypoints=websecure"
      - "traefik.http.routers.<unique-name>.tls.certResolver=letsencrypt"
      - "traefik.http.services.<unique-name>.loadbalancer.server.port=3000"
    environment:
      - MODE=${MODE}
      - RUST_BACKTRACE=${RUST_BACKTRACE}

      - DATABASE_URL_DEV=${DATABASE_URL_DEV}
      - REDIS_URL_DEV=${REDIS_URL_DEV}
      - MINIO_URL_DEV=${MINIO_URL_DEV}
      - DATABASE_URL_PROD=${DATABASE_URL_PROD}
      - REDIS_URL_PROD=${REDIS_URL_PROD}
      - MINIO_URL_PROD=${MINIO_URL_PROD}

      - JWT_SECRET_DEV=${JWT_SECRET_DEV}
      - JWT_SECRET_PROD=${JWT_SECRET_PROD}

      - MINIO_ACCESS_KEY_DEV=${MINIO_ACCESS_KEY_DEV}
      - MINIO_SECRET_KEY_DEV=${MINIO_SECRET_KEY_DEV}
      - MINIO_ACCESS_KEY_PROD=${MINIO_ACCESS_KEY_PROD}
      - MINIO_SECRET_KEY_PROD=${MINIO_SECRET_KEY_PROD}

      - SMTP=${SMTP}

networks:
  dokploy-network:
    external: true